<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>قبله‌نمای واقعی</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f3f3f3;
        }

        .compass {
            position: relative;
            width: 250px;
            height: 250px;
            border: 5px solid #000;
            border-radius: 50%;
            background: #fff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .needle {
            position: absolute;
            width: 4px;
            height: 120px;
            background-color: red; /* عقربه‌ی سمت خورشید */
            top: 50%;
            left: 50%;
            transform-origin: bottom center;
            transform: translate(-50%, -100%);
            z-index: 2;
        }

        .qibla-needle {
            position: absolute;
            width: 4px;
            height: 120px;
            background-color: green; /* عقربه‌ی قبله */
            top: 50%;
            left: 50%;
            transform-origin: bottom center;
            transform: translate(-50%, -100%);
            z-index: 1;
        }

        input, button {
            margin: 10px 0;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        #city {
            width: 220px;
        }
    </style>
</head>
<body>
    <div class="compass">
        <div class="needle"></div> <!-- عقربه‌ی سمت خورشید -->
        <div class="qibla-needle"></div> <!-- عقربه‌ی قبله -->
    </div>

    <input type="text" id="city" placeholder="شهر خود را وارد کنید..." list="cities">
    <datalist id="cities">
        <option value="تهران">
        <option value="مشهد">
        <option value="شیراز">
        <option value="اصفهان">
        <option value="تبریز">
        <option value="قم">
        <option value="اهواز">
        <option value="کرمان">
        <option value="همدان">
        <option value="یزد">
        <option value="شاهرود">
    </datalist>
    <button onclick="updateQibla()">پیدا کردن قبله</button>

    <script>
        // مختصات قبله (مکه)
        const qiblaLat = 21.4225;
        const qiblaLon = 39.8262;

        // اطلاعات شهرها (عرض و طول جغرافیایی)
        const cities = {
            "تهران": { lat: 35.6892, lon: 51.3890 },
            "مشهد": { lat: 36.2605, lon: 59.6168 },
            "شیراز": { lat: 29.6190, lon: 52.5387 },
            "اصفهان": { lat: 32.6613, lon: 51.6804 },
            "تبریز": { lat: 38.0962, lon: 46.2738 },
            "قم": { lat: 34.6399, lon: 50.8759 },
            "اهواز": { lat: 31.3183, lon: 48.6706 },
            "کرمان": { lat: 30.2839, lon: 57.0834 },
            "همدان": { lat: 34.7992, lon: 48.5146 },
            "یزد": { lat: 31.8974, lon: 54.3569 },
            "شاهرود": { lat: 36.4180, lon: 54.9763 }
        };

        let deviceOrientation = 0; // چرخش دستگاه
        let qiblaDirection = 0; // زاویه قبله
        let sunDirection = 0; // زاویه خورشید

        // محاسبه زاویه قبله بر اساس موقعیت کاربر
        function calculateQibla(lat, lon) {
            const deltaLon = (qiblaLon - lon) * (Math.PI / 180);
            const latRad = lat * (Math.PI / 180);
            const qiblaLatRad = qiblaLat * (Math.PI / 180);

            const y = Math.sin(deltaLon) * Math.cos(qiblaLatRad);
            const x = Math.cos(latRad) * Math.sin(qiblaLatRad) - 
                      Math.sin(latRad) * Math.cos(qiblaLatRad) * Math.cos(deltaLon);

            let angle = Math.atan2(y, x) * (180 / Math.PI);
            return (angle + 360) % 360; // نرمال‌سازی زاویه
        }

        // محاسبه زاویه خورشید بر اساس زمان و موقعیت جغرافیایی
        function calculateSunDirection(lat, lon) {
            const now = new Date();
            const hours = now.getUTCHours();
            const minutes = now.getUTCMinutes();
            const time = hours + minutes / 60;

            // نمونه ساده برای محاسبه:
            return (time / 24) * 360;
        }

        // به‌روزرسانی عقربه‌ها
        function updateNeedles() {
            const redNeedle = document.querySelector(".needle");
            const greenNeedle = document.querySelector(".qibla-needle");

            // چرخاندن عقربه‌ی قرمز به سمت خورشید
            redNeedle.style.transform = `translate(-50%, -100%) rotate(${sunDirection - deviceOrientation}deg)`;

            // چرخاندن عقربه‌ی سبز به سمت قبله
            greenNeedle.style.transform = `translate(-50%, -100%) rotate(${qiblaDirection - deviceOrientation}deg)`;
        }

        // تنظیم مقادیر قبله و خورشید
        function updateQibla() {
            const cityInput = document.getElementById("city").value;
            const city = cities[cityInput];

            if (city) {
                qiblaDirection = calculateQibla(city.lat, city.lon);
                sunDirection = calculateSunDirection(city.lat, city.lon);
                alert(`زاویه‌ی قبله و خورشید برای ${cityInput} محاسبه شد.`);
                updateNeedles();
            } else {
                alert("شهر انتخابی معتبر نیست. لطفاً یک شهر معتبر انتخاب کنید.");
            }
        }

        // بررسی پشتیبانی از DeviceOrientationEvent
        if (window.DeviceOrientationEvent) {
            window.addEventListener("deviceorientation", (event) => {
                deviceOrientation = event.alpha; // دریافت زاویه‌ی دستگاه
                updateNeedles();
            });
        } else {
            alert("مرورگر شما از قطب‌نما پشتیبانی نمی‌کند.");
        }
    </script>
</body>
</html>
